块设备添加和删除

一、创建块设备
rbd create rbd1 --size 1024
rbd map rbd1
rbd showmapped
mkfs.ext4 -q /dev/rbd0
mkdir /mnt/ceph
mount /dev/rbd0 /mnt/ceph

二、自动挂载
1、设置开机ceph自动map和mount rbd块设备
vim /etc/ceph/rbdmap
#poolname/imagename id=client,keyring=/etc/ceph/ceph.client.keyring
rbd/rbd1 id=admin,keyring=/etc/ceph/ceph.client.admin.keyring

2、vim /etc/fstab
/dev/rbd/rbd/rbd1 /mnt/ceph ext4 defaults,noatime,_netdev


三、块扩容
rbd resize rbd/rbd1 --size 2048
文件系统在线扩容
resize2fs /dev/rbd0

四、块删除
umount /mnt/ceph
vim /etc/ceph/rbdmap
注释 rbd/rbd1 id=admin,keyring=/etc/ceph/ceph.client.admin.keyring
vim /etc/fstab
注释 /dev/rbd/rbd/rbd1 /mnt/ceph ext4 defaults,noatime,_netdev
rbd rm rbd1

________________________________________________________________

快照和克隆
方法一：rbd --pool {pool-name} snap create --snap {snap-name} {image-name}
方法二：rbd snap create {pool-name}/{image-name}@{snap-name}
列
rbd --pool rbd snap create --snap rbd1_snap rbd1
rbd snap create rbd/rbd1@rbd1_snap

快照回滚
方法一：rbd --pool {pool-name} snap rollback --snap {snap-name} {image-name}
方法二：rbd snap rollback {pool-name}/{image-name}@{snap-name}
列
rbd --pool rbd snap rollback --snap rbd1_snap rbd1
rbd snap rollback rbd/rbd1@rbd1_snap

列出快照
方法一：rbd --pool {pool-name} snap ls {image-name}
方法二：rbd snap ls {pool-name}/{image-name}
列
rbd --pool rbd snap ls rbd1
rbd snap ls rbd/rbd1

保护快照
方法一：rbd --pool {pool-name} snap protect --image {image-name} --snap {snapshot-name}
方法二：rbd snap protect {pool-name}/{image-name}@{snapshot-name}
列
rbd --pool rbd snap protect --image my-image --snap my-snapshot
rbd snap protect rbd/rbd1@rbd1_snap

清除快照（删除所有快照）
方法一：rbd --pool {pool-name} snap purge {image-name}
方法二：rbd snap purge {pool-name}/{image-name}
列
rbd --pool rbd snap purge rbd1
rbd snap purge rbd/rbd1

删除快照(删除指定的)
方法一：rbd --pool {pool-name} snap rm {image-name}
方法二：rbd snap rm {pool-name}/{image-name}
列
rbd --pool rbd snap rm rbd1
rbd snap rm rbd/rbd1
